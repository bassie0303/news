javascript:
(function() { 'use strict'; // æ—¢ã«é–‹ã„ã¦ã„ã‚‹å ´åˆã¯é–‰ã˜ã‚‹ if (document.getElementById('news-share-dialog')) { document.getElementById('news-share-dialog').remove(); return; } // èªè¨¼ãŒå¿…è¦ã‹ã©ã†ã‹ã‚’æ¤œå‡ºã™ã‚‹é–¢æ•° function detectPaywall() { const paywallIndicators = [ '.paywall', '.subscription-required', '.premium-content', '.members-only', '.login-required', '[class*="paywall"]', '[class*="subscription"]', '[class*="premium"]', '#paywall', '#subscription-wall' ]; for (const selector of paywallIndicators) { if (document.querySelector(selector)) { return true; } } const bodyText = document.body.innerText || ''; const paywallTexts = [ 'ä¼šå“¡é™å®š', 'æœ‰æ–™ä¼šå“¡', 'ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦', 'ç¶šãã‚’èª­ã‚€ã«ã¯', 'è³¼èª­è€…é™å®š', 'Subscribe to read', 'Sign in to continue', 'Premium content', 'Members only' ]; for (const text of paywallTexts) { if (bodyText.includes(text)) { return true; } } const articleElement = document.querySelector('article') || document.querySelector('main'); if (articleElement) { const text = articleElement.innerText || ''; if (text.length < 300) { return true; } } return false; } // è¨˜äº‹æƒ…å ±ã‚’å–å¾— function getArticleInfo() { const title = document.title || document.querySelector('h1')?.textContent || document.querySelector('meta[property="og:title"]')?.content || 'ã‚¿ã‚¤ãƒˆãƒ«ãªã—'; const url = window.location.href; // æœ¬æ–‡ã‚’å–å¾— let fullText = ''; const article = document.querySelector('article') || document.querySelector('main') || document.querySelector('.article') || document.querySelector('.post') || document.body; if (article) { const paragraphs = article.querySelectorAll('p'); fullText = Array.from(paragraphs) .map(p => p.textContent.trim()) .filter(text => text.length > 20) .join(''); } // æŠœç²‹ã‚’ç”Ÿæˆ const excerpt = extractImportantSentences(fullText, 800); // èªè¨¼æ¤œå‡º const requiresAuth = detectPaywall(); return { title, url, excerpt, fullText, requiresAuth: requiresAuth, visibleTextLength: fullText.length }; } // é‡è¦ãªæƒ…å ±ã‚’å«ã‚€æ–‡ã‚’æŠ½å‡º function extractImportantSentences(text, maxLength) { const sentences = text.split(/[ã€‚.!?ï¼ï¼Ÿ]\s*/); const scoredSentences = sentences.map(sentence => { let score = 0; if (/\d+/.test(sentence)) score += 3; if (/ã€Œ|ã€|ã€|ã€|"|"/.test(sentence)) score += 4; if (/[A-Z][a-z]+\s+[A-Z][a-z]+|[ã-ã‚“]{2,4}[ã€€\s][ã-ã‚“]{2,4}/.test(sentence)) score += 3; if (/[A-Z][a-z]+|[ã‚¡-ãƒ´ãƒ¼]{3,}/.test(sentence)) score += 2; const keywords = ['ç™ºè¡¨', 'ç™ºè¨€', 'æ˜ã‚‰ã‹', 'åˆ¤æ˜', 'ç™ºè¦‹', 'é–‹ç™º', 'æ–°ãŸ', 'åˆã‚ã¦', 'æœ€å¤§', 'æœ€å°', 'å¢—åŠ ', 'æ¸›å°‘', 'ä¸Šæ˜‡', 'ä¸‹é™']; keywords.forEach(keyword => { if (sentence.includes(keyword)) score += 2; }); if (sentence.length > 20 && sentence.length < 150) score += 1; return { sentence, score }; }); scoredSentences.sort((a, b) => b.score - a.score); let excerpt = ''; for (const item of scoredSentences) { if (item.sentence.trim().length === 0) continue; const testExcerpt = excerpt + (excerpt ? 'ã€‚' : '') + item.sentence.trim(); if (testExcerpt.length <= maxLength) { excerpt = testExcerpt; } else { break; } } if (excerpt && !excerpt.match(/[ã€‚.!?ï¼ï¼Ÿ]$/)) { excerpt += 'ã€‚'; } return excerpt; } // ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•° function formatForFacebook(title, excerpt, url) { const quotedExcerpt = excerpt ? `ã€Œ${excerpt}ã€` : ''; let post = title; if (quotedExcerpt) { post += '\n\n' + quotedExcerpt; } post += '\n\n' + url; if (post.length > 1000) { const overhead = title.length + url.length + 10; const maxExcerptLength = 1000 - overhead - 3; if (maxExcerptLength > 0) { const trimmedExcerpt = excerpt.substring(0, maxExcerptLength) + '...'; post = title + '\n\nã€Œ' + trimmedExcerpt + 'ã€\n\n' + url; } else { post = title + '\n\n' + url; } } return post; } function formatForThreads(title, excerpt, url) { const quotedExcerpt = excerpt ? `ã€Œ${excerpt}ã€` : ''; let post = title; if (quotedExcerpt) { post += '\n\n' + quotedExcerpt; } post += '\n\n' + url; if (post.length > 500) { const overhead = title.length + url.length + 10; const maxExcerptLength = 500 - overhead - 3; if (maxExcerptLength > 0) { const trimmedExcerpt = excerpt.substring(0, maxExcerptLength) + '...'; post = title + '\n\nã€Œ' + trimmedExcerpt + 'ã€\n\n' + url; } else { post = title + '\n\n' + url; } } return post; } function formatForX(title, excerpt, url) { const quotedExcerpt = excerpt ? `ã€Œ${excerpt}ã€` : ''; let post = title; if (quotedExcerpt) { post += '\n' + quotedExcerpt; } post += '\n' + url; if (post.length > 140) { const overhead = title.length + url.length + 6; const maxExcerptLength = 140 - overhead - 3; if (maxExcerptLength > 0) { const trimmedExcerpt = excerpt.substring(0, maxExcerptLength) + '...'; post = title + '\nã€Œ' + trimmedExcerpt + 'ã€\n' + url; } else { const maxTitleLength = 140 - url.length - 5; if (maxTitleLength > 0) { const trimmedTitle = title.substring(0, maxTitleLength) + '...'; post = trimmedTitle + '\n' + url; } else { post = url; } } } return post; } // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ async function copyToClipboard(text) { try { await navigator.clipboard.writeText(text); return true; } catch (err) { // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ const textarea = document.createElement('textarea'); textarea.value = text; textarea.style.position = 'fixed'; textarea.style.opacity = '0'; document.body.appendChild(textarea); textarea.select(); const success = document.execCommand('copy'); document.body.removeChild(textarea); return success; } } // è¨˜äº‹æƒ…å ±ã‚’å–å¾— const articleData = getArticleInfo(); // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®HTML const dialogHTML = ` <div id="news-share-dialog" style=" position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); z-index: 999999; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; "> <div style="padding: 20px;"> <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;"> <h2 style="margin: 0; font-size: 20px; color: #333;">ğŸ“° è¨˜äº‹ã‚’ã‚·ã‚§ã‚¢</h2> <button id="close-dialog" style=" background: none; border: none; font-size: 24px; cursor: pointer; color: #666; padding: 0; width: 30px; height: 30px; ">Ã—</button> </div> ${articleData.requiresAuth ? ` <div id="auth-warning" style=" background: #fff3cd; border: 2px solid #ffc107; padding: 12px; border-radius: 8px; margin-bottom: 15px; font-size: 12px; color: #856404; "> <strong style="display: block; margin-bottom: 8px; font-size: 13px;">âš ï¸ èªè¨¼ãŒå¿…è¦ãªè¨˜äº‹</strong> <p style="margin: 5px 0; line-height: 1.4;">ã“ã®è¨˜äº‹ã¯èªè¨¼ãŒå¿…è¦ãªå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ç¾åœ¨è¦‹ãˆã¦ã„ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã¯${articleData.visibleTextLength}æ–‡å­—ã§ã™ã€‚</p> <div style="display: flex; gap: 8px; margin-top: 8px;"> <button id="use-visible-only" style=" flex: 1; padding: 8px; font-size: 12px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; ">è¦‹ãˆã¦ã„ã‚‹éƒ¨åˆ†ã ã‘ä½¿ç”¨</button> <button id="login-first" style=" flex: 1; padding: 8px; font-size: 12px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; ">ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‹ã‚‰å†å®Ÿè¡Œ</button> </div> </div> ` : ''} <div style="background: #f5f5f5; padding: 12px; border-radius: 8px; margin-bottom: 15px;"> <h3 style="margin: 0 0 8px 0; font-size: 14px; color: #666;">è¨˜äº‹æƒ…å ±</h3> <p style="margin: 5px 0; font-size: 12px; color: #333; word-wrap: break-word;"> <strong>ã‚¿ã‚¤ãƒˆãƒ«:</strong> ${articleData.title} </p> <p style="margin: 5px 0; font-size: 12px; color: #333; word-wrap: break-word;"> <strong>URL:</strong> ${articleData.url} </p> <div style="max-height: 100px; overflow-y: auto; background: white; padding: 8px; border-radius: 4px; margin-top: 8px;"> <strong style="font-size: 12px;">æŠœç²‹:</strong> <p style="margin: 5px 0; font-size: 12px; color: #333;">${articleData.excerpt || 'æŠœç²‹ãªã—'}</p> </div> </div> <div style="display: flex; flex-direction: column; gap: 10px;"> <button id="share-all" style=" padding: 14px; border: none; border-radius: 6px; cursor: pointer; font-size: 15px; font-weight: 600; color: white; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); transition: all 0.3s; ">ğŸš€ ã™ã¹ã¦ã«ä¸€æ‹¬æŠ•ç¨¿</button> <button id="share-facebook" style=" padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; color: white; background: #1877f2; transition: all 0.3s; ">Facebookã«æŠ•ç¨¿</button> <button id="share-threads" style=" padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; color: white; background: #000000; transition: all 0.3s; ">Threadsã«æŠ•ç¨¿</button> <button id="share-x" style=" padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; color: white; background: #000000; transition: all 0.3s; ">Xã«æŠ•ç¨¿</button> </div> <div id="status" style=" margin-top: 15px; padding: 10px; border-radius: 6px; font-size: 12px; display: none; "></div> </div> </div> <div id="news-share-overlay" style=" position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 999998; "></div> `; // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’æŒ¿å…¥ document.body.insertAdjacentHTML('beforeend', dialogHTML); // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º function showStatus(message, type) { const statusEl = document.getElementById('status'); statusEl.textContent = message; statusEl.style.display = 'block'; if (type === 'success') { statusEl.style.background = '#d4edda'; statusEl.style.color = '#155724'; } else if (type === 'error') { statusEl.style.background = '#f8d7da'; statusEl.style.color = '#721c24'; } else { statusEl.style.background = '#d1ecf1'; statusEl.style.color = '#0c5460'; } setTimeout(() => { statusEl.style.display = 'none'; }, 3000); } // é–‰ã˜ã‚‹ function closeDialog() { document.getElementById('news-share-dialog')?.remove(); document.getElementById('news-share-overlay')?.remove(); } // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ document.getElementById('close-dialog').addEventListener('click', closeDialog); document.getElementById('news-share-overlay').addEventListener('click', closeDialog); // èªè¨¼è­¦å‘Šã®ãƒœã‚¿ãƒ³ if (articleData.requiresAuth) { document.getElementById('use-visible-only')?.addEventListener('click', () => { document.getElementById('auth-warning').style.display = 'none'; showStatus('è¦‹ãˆã¦ã„ã‚‹éƒ¨åˆ†ã ã‘ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚', 'success'); }); document.getElementById('login-first')?.addEventListener('click', () => { showStatus('è¨˜äº‹ãƒšãƒ¼ã‚¸ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‹ã‚‰ã€ã‚‚ã†ä¸€åº¦ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚', 'info'); setTimeout(() => closeDialog(), 2000); }); } // FacebookæŠ•ç¨¿ document.getElementById('share-facebook').addEventListener('click', async () => { const postText = formatForFacebook(articleData.title, articleData.excerpt, articleData.url); await copyToClipboard(postText); window.open('https://www.facebook.com/?sk=h_chr', '_blank'); showStatus('Facebookã‚’é–‹ãã¾ã—ãŸã€‚æŠ•ç¨¿ãƒœãƒƒã‚¯ã‚¹ã§Ctrl+Vï¼ˆCmd+Vï¼‰ã§è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚', 'success'); }); // ThreadsæŠ•ç¨¿ document.getElementById('share-threads').addEventListener('click', async () => { const postText = formatForThreads(articleData.title, articleData.excerpt, articleData.url); await copyToClipboard(postText); window.open('https://www.threads.net/new', '_blank'); showStatus('Threadsã‚’é–‹ãã¾ã—ãŸã€‚æŠ•ç¨¿ãƒœãƒƒã‚¯ã‚¹ã§Ctrl+Vï¼ˆCmd+Vï¼‰ã§è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚', 'success'); }); // XæŠ•ç¨¿ document.getElementById('share-x').addEventListener('click', async () => { const postText = formatForX(articleData.title, articleData.excerpt, articleData.url); await copyToClipboard(postText); const intentUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(postText)}`; window.open(intentUrl, '_blank'); showStatus('Xã‚’é–‹ãã¾ã—ãŸã€‚æŠ•ç¨¿å†…å®¹ã‚’ç¢ºèªã—ã¦æŠ•ç¨¿ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚', 'success'); }); // ä¸€æ‹¬æŠ•ç¨¿ document.getElementById('share-all').addEventListener('click', async () => { const fbText = formatForFacebook(articleData.title, articleData.excerpt, articleData.url); const threadsText = formatForThreads(articleData.title, articleData.excerpt, articleData.url); const xText = formatForX(articleData.title, articleData.excerpt, articleData.url); await copyToClipboard(fbText); window.open('https://www.facebook.com/?sk=h_chr', '_blank'); setTimeout(() => window.open('https://www.threads.net/new', '_blank'), 500); setTimeout(() => window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(xText)}`, '_blank'), 1000); showStatus('3ã¤ã®SNSã‚’é–‹ãã¾ã—ãŸï¼å„ã‚¿ãƒ–ã§æŠ•ç¨¿ãƒœãƒƒã‚¯ã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦Ctrl+Vï¼ˆCmd+Vï¼‰ã§è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚', 'success'); }); })();